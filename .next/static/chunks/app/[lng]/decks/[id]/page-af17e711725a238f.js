(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8439],{34614:(e,o,n)=>{Promise.resolve().then(n.bind(n,28003)),Promise.resolve().then(n.bind(n,46179))},28003:(e,o,n)=>{"use strict";n.d(o,{default:()=>N});var i=n(57437),t=n(2265),r=n(1597),c=n(22281),s=n(1959),a=n(41707),l=n(99763),m=n(86608),d=n(7497),u=n(35671),h=n(49309),p=n(99075),f=n(70132),g=n(96293),x=n(83184),j=n(71719),k=n(40665),w=n(91601),_=n(85254),b=n(22966),y=n(29056),v=n(45896),C=n(47834),Z=n(11620),E=n(98953),S=n(87138),z=n(47025),A=n(81173),R=n.n(A),P=n(30998),T=n(60327),O=n(16463),D=n(81822);let N=e=>{let{lng:o}=e,{data:n}=(0,P.useSession)(),{t:A}=(0,z.$)(o,["pokemon","common","skill","ability","rule"]),[N,F]=(0,t.useState)(null),[M,B]=(0,t.useState)(!0),[L,U]=(0,t.useState)([]),[G,J]=(0,t.useState)(null),[H,I]=(0,t.useState)(!1),[K,W]=(0,t.useState)(0),[V,X]=(0,t.useState)(""),[$,q]=(0,t.useState)(!1),[Q,Y]=(0,t.useState)(0),[ee,eo]=(0,t.useState)(0),{id:en}=(0,O.useParams)(),{colorScheme:ei}=(0,r.X)(),et=(0,t.useRef)(null);(0,t.useEffect)(()=>{var e;if(null==n?void 0:null===(e=n.user)||void 0===e?void 0:e.id){if(!en||Array.isArray(en)){J(A("common:notification.error_invalid_id")),B(!1);return}(async()=>{try{let e=await fetch("/api/decks/".concat(en),{method:"GET",credentials:"include"});if(!e.ok){let o=await e.json();J(o.message||A("common:notification.error_fetch_deck")),B(!1);return}let o=await e.json();I(o.isSaved),B(!1)}catch(e){console.error("Error fetching Deck:",e),B(!1)}})()}},[en,A]),(0,t.useEffect)(()=>{if(!en||Array.isArray(en)){J(A("common:notification.error_invalid_id")),B(!1);return}(async()=>{try{let e=await fetch("/api/decks/user/".concat(en),{method:"GET",credentials:"include"});if(!e.ok){let o=await e.json();J(o.message||A("common:notification.error_fetch_deck")),B(!1);return}let o=await e.json();F(o.deck);let n=o.deck.deckCards.split(",").map(e=>{let n=o.cards.find(o=>o.number===e.trim());return n?{...n}:null}).filter(e=>null!==e);U(n),B(!1)}catch(e){console.error("Error fetching Deck:",e),J(A("common:notification.error_fetch_deck")),B(!1)}})()},[en,A]);let er=(0,t.useMemo)(()=>{let e={pokemon:0,item:0,supporter:0};return L.forEach(o=>{0===o.type?e.pokemon+=1:1===o.type?e.item+=1:2===o.type&&(e.supporter+=1)}),e},[L]),ec=(0,t.useMemo)(()=>({pokemon:5*er.pokemon,item:5*er.item,supporter:5*er.supporter}),[er]),es=(0,t.useMemo)(()=>L.reduce((e,o)=>e+D.pt[o.rarity],0),[L,D.pt]),ea=async()=>{if(!(null==n?void 0:n.user)){(0,T.c0)({title:A("common:notification.error_not_logged_in"),message:A("common:notification.error_please_login"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})});return}try{let e=await fetch("/api/decks/".concat(en),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deckCards:L,deckName:A("common:notification.notification_unnamed")})}),o=await e.json();e.ok?((0,T.c0)({title:A("common:notification.success"),message:A("common:notification.success_deck_saved"),color:"green",icon:(0,i.jsx)(y.Z,{size:16})}),I(!0)):(0,T.c0)({title:A("common:notification.error"),message:o.message||A("common:notification.error_save_deck_failed"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}catch(e){(0,T.c0)({title:A("common:notification.error"),message:A("common:notification.error_save_deck"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}finally{B(!1)}},el=async()=>{if(!(null==n?void 0:n.user)){(0,T.c0)({title:A("common:notification.error_not_logged_in"),message:A("common:notification.error_please_login"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})});return}try{let e=await fetch("/api/decks/".concat(en),{method:"DELETE",headers:{"Content-Type":"application/json"}}),o=await e.json();e.ok?((0,T.c0)({title:A("common:notification.success"),message:A("common:notification.success_deck_deleted"),color:"green",icon:(0,i.jsx)(y.Z,{size:16})}),I(!1)):(0,T.c0)({title:A("common:notification.error_title"),message:o.message||A("common:notification.error_delete_deck_failed"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}catch(e){(0,T.c0)({title:A("common:notification.error_title"),message:A("common:notification.error_delete_deck"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}finally{B(!1)}},em=async()=>{if(!(null==n?void 0:n.user)){(0,T.c0)({title:A("common:notification.error_not_logged_in"),message:A("common:notification.error_please_login"),color:"red",icon:(0,i.jsx)(b.Z,{size:16})});return}q(!0);try{let e=await fetch("/api/decks/".concat(en,"/rating"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rating:K,comment:V})}),o=await e.json();e.ok?((0,T.c0)({title:A("common:notification.success"),message:"您的評分已提交",color:"green",icon:(0,i.jsx)(y.Z,{size:16})}),W(0),X("")):(0,T.c0)({title:A("common:notification.error_title"),message:o.message||"提交評分時出錯",color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}catch(e){console.error("Error submitting rating:",e),(0,T.c0)({title:A("common:notification.error_title"),message:"提交評分時發生伺服器錯誤",color:"red",icon:(0,i.jsx)(b.Z,{size:16})})}finally{q(!1)}};(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/decks/".concat(en,"/rating")),o=await e.json();e.ok?(Y(o.averageRating),eo(o.ratingCount)):console.error(o.message)}catch(e){}finally{B(!1)}})()},[en]);let ed=async()=>{if(et.current){let e=et.current.cloneNode(!0);e.style.backgroundColor="dark"===ei?"#242424":"#FFFFFF",document.body.appendChild(e);let o=await R()(e,{backgroundColor:null,useCORS:!0});document.body.removeChild(e);let n=o.toDataURL("image/png"),i=document.createElement("a");i.href=n,i.download="pokemonnier.png",i.click()}},eu=[{title:A("common:navigation.home"),href:"/"},{title:A("common:navigation.deck_list"),href:"/decks/list"},{title:A("common:navigation.deck"),href:"#"}].map((e,o)=>(0,i.jsx)(c.e,{href:e.href,children:e.title},o));return(0,i.jsxs)(s.W,{size:"lg",children:[(0,i.jsx)(a.O,{children:eu}),(0,i.jsxs)(l.Title,{order:1,mt:"md",children:[en," - ",A("common:navigation.deck")]}),(0,i.jsxs)(m.Z,{mt:"md",justify:"flex-end",children:[(0,i.jsx)(d.A,{variant:"default",size:"lg",onClick:ed,children:(0,i.jsx)(v.Z,{})}),H?(0,i.jsx)(d.A,{variant:"default",size:"lg",onClick:el,loading:M,children:(0,i.jsx)(C.Z,{color:"#fcc419"})}):(0,i.jsx)(d.A,{variant:"default",size:"lg",onClick:ea,loading:M,children:(0,i.jsx)(Z.Z,{color:"#fcc419"})})]}),(0,i.jsxs)("div",{ref:et,children:[(0,i.jsx)(u.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,mt:"md",children:(0,i.jsx)(h.r,{columns:10,children:L.map((e,n)=>(0,i.jsxs)(h.r.Col,{span:{base:2,sm:2,md:1,lg:1},children:[(0,i.jsx)(S.default,{href:"/".concat(o,"/cards/").concat(e.number),passHref:!0,style:{textDecoration:"none"},children:(0,i.jsx)(p.E,{radius:"md",src:"/".concat(o,"/").concat(e.set,"/").concat(e.number,".webp"),alt:"".concat(e.number)})}),(0,i.jsxs)(f.K,{mt:"md",align:"center",gap:"xs",children:[(0,i.jsx)(g.Text,{fw:700,size:"xs",children:A("pokemon:".concat(e.name))}),(0,i.jsx)(g.Text,{c:"dimmed",size:"xs",children:e.number})]})]},"".concat(en,"-").concat(e.set,"-").concat(e.number,"-").concat(n)))})}),(0,i.jsx)(h.r,{mt:"md",children:(0,i.jsx)(h.r.Col,{span:12,children:(0,i.jsxs)(u.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[(0,i.jsxs)(m.Z,{mb:"md",children:[(0,i.jsx)(x.C,{color:"cyan",variant:"filled",children:A("common:pokemon")}),(0,i.jsx)(x.C,{color:"pink",variant:"filled",children:A("common:item")}),(0,i.jsx)(x.C,{color:"orange",variant:"filled",children:A("common:supporter")})]}),(0,i.jsxs)(j.E.Root,{size:"20",children:[(0,i.jsx)(j.E.Section,{value:ec.pokemon,color:"cyan",children:(0,i.jsx)(j.E.Label,{children:er.pokemon})}),(0,i.jsx)(j.E.Section,{value:ec.item,color:"pink",children:(0,i.jsx)(j.E.Label,{children:er.item})}),(0,i.jsx)(j.E.Section,{value:ec.supporter,color:"orange",children:(0,i.jsx)(j.E.Label,{children:er.supporter})})]})]})})}),(0,i.jsxs)(h.r,{children:[(0,i.jsx)(h.r.Col,{span:{base:12,sm:12,md:4,lg:4},children:(0,i.jsxs)(u.Z,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[A("common:points"),": ",es]})}),(0,i.jsx)(h.r.Col,{span:{base:12,sm:12,md:4,lg:4},children:(0,i.jsx)(u.Z,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,children:(0,i.jsxs)(m.Z,{align:"center",children:[(0,i.jsx)(k.i,{value:Q,fractions:4,readOnly:!0,size:"lg"}),(0,i.jsx)(g.Text,{fw:"600",children:Q.toFixed(2)})]})})})]})]}),(0,i.jsx)(w.i,{my:"xs",labelPosition:"left"}),(0,i.jsx)(h.r,{mt:"md",children:(0,i.jsx)(h.r.Col,{span:12,children:(0,i.jsxs)(u.Z,{padding:"xs",radius:"md",withBorder:!0,children:[(0,i.jsx)(u.Z.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:(0,i.jsx)(m.Z,{justify:"space-between",children:(0,i.jsx)(g.Text,{children:A("common:sorting.rating")})})}),(0,i.jsx)(k.i,{defaultValue:0,size:"lg",fractions:2,value:K,onChange:W,mt:"sm"}),(0,i.jsx)(_.z,{leftSection:(0,i.jsx)(E.Z,{size:14}),variant:"default",fullWidth:!0,mt:"md",radius:"md",onClick:em,disabled:$,children:A("common:sorting.submit")})]})})})]})}},81822:(e,o,n)=>{"use strict";n.d(o,{D:()=>a,Gg:()=>d,JG:()=>l,KH:()=>c,Nr:()=>m,PZ:()=>r,RP:()=>u,l6:()=>s,pt:()=>t,x9:()=>i});let i={A1:["A1C","A1M","A1P"],"PROMO-A":[]},t={0:0,1:35,2:70,3:150,4:500,5:400,6:1250,7:1500,8:2500},r={0:"/common/grass.webp",1:"/common/fire.webp",2:"/common/water.webp",3:"/common/lightning.webp",4:"/common/psychic.webp",5:"/common/fighting.webp",6:"/common/darkness.webp",7:"/common/metal.webp",8:"/common/dragon.webp",9:"/common/colorless.webp"},c={grass:0,fire:1,water:2,lightning:3,psychic:4,fighting:5,darkness:6,metal:7,dragon:8,colorless:9},s={Common:1,Uncommon:2,Rare:3,DoubleRare:4,ArtRare:5,SuperRare:6,ImmersiveRare:7,UltraRare:8},a={pokemon:0,item:1,supporter:2},l={0:"",1:"/common/Common.webp",2:"/common/Uncommon.webp",3:"/common/Rare.webp",4:"/common/DoubleRare.webp",5:"/common/ArtRare.webp",6:"/common/SuperRare.webp",7:"/common/ImmersiveRare.webp",8:"/common/UltraRare.webp"},m={0:[0,0,0],1:[100,0,0],2:[0,90,60],3:[0,5,20],4:[0,1.666,6.664],5:[0,2.572,10.288],6:[0,.5,2],7:[0,.222,.888],8:[0,.04,.16]},d={A1C:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[40,40,40],[50,50,50],[5,5,5],[5,5,5]],A1M:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[42.105,42.105,42.105],[47.368,47.368,47.368],[5.263,5.263,5.263],[5.263,5.263,5.263]],A1P:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[40,40,40],[50,50,50],[5,5,5],[5,5,5]]},u={A1C:"red",A1M:"purple",A1P:"yellow"}}},e=>{var o=o=>e(e.s=o);e.O(0,[253,5501,7337,8839,1141,5948,2008,7235,5179,6114,6179,7130,6215,1744],()=>o(34614)),_N_E=e.O()}]);