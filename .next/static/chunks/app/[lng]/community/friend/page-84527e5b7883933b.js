(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{54354:(e,s,t)=>{Promise.resolve().then(t.bind(t,40938)),Promise.resolve().then(t.bind(t,46179))},40938:(e,s,t)=>{"use strict";t.d(s,{default:()=>C});var i=t(57437),n=t(2265),r=t(22281),o=t(1959),a=t(41707),l=t(99763),m=t(41198),d=t(96293),c=t(49309),h=t(35671),u=t(86608),x=t(62391),j=t(9399),g=t(85254),f=t(91601),p=t(98557),y=t(34479),w=t(99385),_=t(42554),b=t(7497),v=t(77967),S=t(29056),k=t(54545),Z=t(30998),T=t(47025),z=t(60327),P=t(4301);let C=e=>{let{lng:s}=e,{data:t}=(0,Z.useSession)(),{t:C}=(0,T.$)(s,["pokemon","common","skill","ability","rule"]),[E,B]=(0,n.useState)([]),[I,O]=(0,n.useState)([]),[N,V]=(0,n.useState)(!1),[A,F]=(0,n.useState)(""),[q,D]=(0,n.useState)(""),L=(0,P.c)({initialValues:{message:"",status:!0},validate:{message:e=>0===e.trim().length?C("common:empty_message"):e.length>60?C("common:message_too_long"):null}});(0,n.useEffect)(()=>{(async()=>{if(t)try{let e=await fetch("/api/user/getUser"),s=await e.json();e.ok&&(F(s.user.name),D(s.user.pokemonId))}catch(e){}})()},[t]);let M=async()=>{V(!0);try{let e=await fetch("/api/community/friend"),s=await e.json();e.ok&&B(s.friends)}catch(e){}finally{V(!1)}},J=async()=>{var e;if(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id){V(!0);try{let e=await fetch("/api/community/friend/user"),s=await e.json();e.ok&&O(s.friends)}catch(e){}finally{}}};(0,n.useEffect)(()=>{M(),J()},[]),(0,n.useEffect)(()=>{I.length>0&&(L.setFieldValue("message",I[0].message),L.setFieldValue("status","true"===I[0].status))},[I]);let R=async e=>{try{let s=await fetch("/api/community/friend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.message,status:e.status.toString()})}),t=await s.json();s.ok?((0,z.c0)({title:C("common:notification.success"),message:C("common:notification.update_success"),color:"green"}),M(),J(),L.reset()):(0,z.c0)({title:C("common:notification.error_title"),message:t.error||C("common:notification.update_failed"),color:"red"})}catch(e){console.error("Error adding friend:",e),(0,z.c0)({title:C("common:notification.error_title"),message:C("common:notification.update_failed"),color:"red"})}},U=[{title:C("common:navigation.home"),href:"/"},{title:C("common:community"),href:"#"},{title:C("common:friend"),href:"#"}].map((e,s)=>(0,i.jsx)(r.e,{href:e.href,children:e.title},s)),W=(0,i.jsx)(v.Z,{});return(0,i.jsxs)(o.W,{size:"lg",children:[(0,i.jsx)(a.O,{children:U}),(0,i.jsx)(l.Title,{order:1,mt:"sm",children:"好友"}),(0,i.jsx)(m.V,{color:"blue",icon:W,mt:"xl",children:(0,i.jsx)(d.Text,{children:C("common:no_unrelated_messages")})}),(null==t?void 0:t.user)&&(0,i.jsx)(c.r,{mt:"md",children:(0,i.jsx)(c.r.Col,{span:12,children:(0,i.jsx)(h.Z,{withBorder:!0,shadow:"sm",radius:"md",children:(0,i.jsxs)("form",{onSubmit:L.onSubmit(R),children:[(0,i.jsx)(h.Z.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:(0,i.jsxs)(u.Z,{mb:"xs",children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,children:A}),(0,i.jsx)(d.Text,{c:"dimmed",size:"xs",children:q})]}),(0,i.jsx)(x.r,{mt:"md",label:C("common:show_message"),...L.getInputProps("status",{type:"checkbox"})})]})}),(0,i.jsx)(j.g,{mb:"md",label:C("common:message"),placeholder:C("common:enter_message"),...L.getInputProps("message"),required:!0,maxLength:60,rightSection:"".concat(L.values.message.length,"/60"),rightSectionProps:{style:{pointerEvents:"none",paddingRight:10}}}),(0,i.jsx)(h.Z.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:(0,i.jsx)(u.Z,{mt:"md",justify:"center",children:(0,i.jsx)(g.z,{type:"submit",children:C("common:share")})})})]})})})}),(0,i.jsx)(f.i,{my:"md"}),N?(0,i.jsx)(p.M,{mt:"lg",children:(0,i.jsx)(y.a,{})}):(0,i.jsx)(i.Fragment,{children:E.length>0?(0,i.jsx)(c.r,{mt:"md",children:E.map(e=>{var s;return(0,i.jsx)(c.r.Col,{span:{base:12,sm:12,md:6,lg:4},children:(0,i.jsxs)(h.Z,{withBorder:!0,shadow:"sm",radius:"md",children:[(0,i.jsx)(h.Z.Section,{withBorder:!0,inheritPadding:!0,py:"xs",children:(0,i.jsxs)(u.Z,{mb:"xs",children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)(d.Text,{size:"sm",fw:500,children:null!==(s=e.user.name)&&void 0!==s?s:""}),(0,i.jsx)(d.Text,{c:"dimmed",size:"xs",children:e.user.pokemonId})]}),(0,i.jsx)(w.q,{value:e.user.pokemonId,timeout:2e3,children:e=>{let{copied:s,copy:t}=e;return(0,i.jsx)(_.u,{label:s?"Copied":"Copy",withArrow:!0,position:"right",children:(0,i.jsx)(b.A,{color:s?"teal":"gray",variant:"subtle",onClick:t,children:s?(0,i.jsx)(S.Z,{}):(0,i.jsx)(k.Z,{})})})}})]})}),(0,i.jsx)(d.Text,{size:"sm",c:"dimmed",mt:"md",children:e.message}),(0,i.jsx)(u.Z,{mt:"sm",justify:"flex-end",children:(0,i.jsx)(d.Text,{size:"xs",c:"dimmed",mt:"md",children:new Date(e.createdAt).toLocaleDateString()})})]})},e.id)})}):(0,i.jsx)(p.M,{mt:"lg",children:(0,i.jsx)(d.Text,{c:"dimmed",size:"sm",children:C("common:no_data_found")})})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[253,5501,8839,1141,5948,2008,9498,1498,8088,8201,6179,7130,6215,1744],()=>s(54354)),_N_E=e.O()}]);